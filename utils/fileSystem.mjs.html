<html>
  <head>
    <base href=".."/>
    <title>doctus - fileSystem.mjs</title>

    <link rel="stylesheet" href="_/github-markdown.min-05fea8df8ec68cb6c27337f6db65733e.css">
    <link rel="stylesheet" href="_/highlight-c281e701b2830b095c67417cd9a7b210.css">
    <link rel="stylesheet" href="_/style-aea3468ccb7ee0c3c4c2b5d339fc989e.css">

    <script src="~/plugins/core/example/ExampleViewer.js"></script>
  </head>
  <body class="markdown-body flex-column">
    <div class="header flex">
      <a class="header-brand" href="./index.html">doctus</a>
      
<ul class="menu flex align-center justify-center">
  
    
    <li class="menu-item">
      <a 
        class="menu-link"
        
          href="examples/index.html"
        
        
          role="button"
          
          aria-expanded="false"
        
      >
        Examples
      </a>
      
    </li>
    
  
</ul>
    </div>
      
      

<main class="flex-grow flex h-100">
  <div class="sidebar border-right mr-2 flex-noshrink">
  
<ul class="menu">
  
    
    <li class="menu-item">
      <a 
        class="menu-link"
        
          href="examples/index.html"
        
        
          role="button"
          
          aria-expanded="false"
        
      >
        Examples
      </a>
      
        
<ul class="menu">
  
    
    <li class="menu-item">
      <a 
        class="menu-link"
        
          href="examples/code-preview.html"
        
        
      >
        Code Preview
      </a>
      
    </li>
    
  
    
    <li class="menu-item">
      <a 
        class="menu-link"
        
          href="examples/components/index.html"
        
        
          role="button"
          
          aria-expanded="false"
        
      >
        Components
      </a>
      
        
<ul class="menu">
  
    
    <li class="menu-item">
      <a 
        class="menu-link"
        
          href="examples/components/test.html"
        
        
      >
        Test
      </a>
      
    </li>
    
  
    
    <li class="menu-item">
      <a 
        class="menu-link"
        
          href="examples/components/Panel.html"
        
        
      >
        Panel
      </a>
      
    </li>
    
  
    
    <li class="menu-item">
      <a 
        class="menu-link"
        
          href="examples/components/Button.html"
        
        
      >
        Button
      </a>
      
    </li>
    
  
    
    <li class="menu-item">
      <a 
        class="menu-link"
        
          href="examples/components/OutlineButton.html"
        
        
      >
        OutlineButton
      </a>
      
    </li>
    
  
    
    <li class="menu-item">
      <a 
        class="menu-link"
        
          href="examples/components/Base.html"
        
        
      >
        Base
      </a>
      
    </li>
    
  
</ul>
      
    </li>
    
  
    
    <li class="menu-item">
      <a 
        class="menu-link"
        
          href="examples/forms/index.html"
        
        
          role="button"
          
          aria-expanded="false"
        
      >
        Forms
      </a>
      
        
<ul class="menu">
  
    
    <li class="menu-item">
      <a 
        class="menu-link"
        
          href="examples/forms/TextField.html"
        
        
      >
        TextField
      </a>
      
    </li>
    
  
    
    <li class="menu-item">
      <a 
        class="menu-link"
        
          href="examples/forms/FormControl.html"
        
        
      >
        FormControl
      </a>
      
    </li>
    
  
    
    <li class="menu-item">
      <a 
        class="menu-link"
        
          href="examples/forms/CheckboxControl.html"
        
        
      >
        CheckboxControl
      </a>
      
    </li>
    
  
</ul>
      
    </li>
    
  
    
    <li class="menu-item">
      <a 
        class="menu-link"
        
          href="examples/utils/index.html"
        
        
      >
        Utils
      </a>
      
    </li>
    
  
</ul>
      
    </li>
    
  
</ul>
</div>
  <div class="flex-grow">
    <div class="container py-4">
      <h1>Source: fileSystem.mjs</h1>
      <p>
        utils/fileSystem.mjs
      </p>
      
      <pre><code class="hljs"><span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;path&#x27;</span>;
<span class="hljs-keyword">import</span> os <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;os&#x27;</span>;
<span class="hljs-keyword">import</span> crypto <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;crypto&#x27;</span>;

<span class="hljs-keyword">import</span> {
  existsSync,
  readFileSync,
  writeFileSync,
  mkdirSync,
  readdirSync,
  unlinkSync,
  copyFileSync,
  lstatSync
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;fs&#x27;</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">getTempDir</span> = (<span class="hljs-params">projectDir = process.cwd()</span>) =&gt; {
  <span class="hljs-keyword">const</span> id = crypto
    .<span class="hljs-title function_">createHash</span>(<span class="hljs-string">&#x27;md5&#x27;</span>)
    .<span class="hljs-title function_">update</span>(<span class="hljs-string">`doctus:<span class="hljs-subst">${projectDir}</span>`</span>)
    .<span class="hljs-title function_">digest</span>(<span class="hljs-string">&quot;hex&quot;</span>);
  <span class="hljs-keyword">const</span> directory = path.<span class="hljs-title function_">join</span>(os.<span class="hljs-title function_">tmpdir</span>(), id);

  <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">existsSync</span>(directory)) {
    <span class="hljs-title function_">mkdirSync</span>(directory);
  }

  <span class="hljs-keyword">return</span> directory;
}


<span class="hljs-keyword">function</span> <span class="hljs-title function_">removeAllFilesSync</span>(<span class="hljs-params">directory</span>) {
    <span class="hljs-keyword">const</span> files = <span class="hljs-title function_">readdirSync</span>(directory);
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> file <span class="hljs-keyword">of</span> files) {
      <span class="hljs-keyword">const</span> filePath = path.<span class="hljs-title function_">join</span>(directory, file);

      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">lstatSync</span>(filePath).<span class="hljs-title function_">isDirectory</span>()) {
        <span class="hljs-title function_">removeAllFilesSync</span>(filePath);

        <span class="hljs-keyword">continue</span>;
      }

      <span class="hljs-title function_">unlinkSync</span>(filePath);
    }
}


<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">createFileSystem</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-keyword">const</span> dir = <span class="hljs-title function_">getTempDir</span>();
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">getFile</span> = file =&gt; path.<span class="hljs-title function_">join</span>(dir, file);
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">clear</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-title function_">removeAllFilesSync</span>(dir);
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">exists</span> = (<span class="hljs-params">file</span>) =&gt; <span class="hljs-title function_">existsSync</span>(<span class="hljs-title function_">getFile</span>(file));
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">read</span> = (<span class="hljs-params">file, encoding = <span class="hljs-literal">null</span></span>) =&gt; <span class="hljs-title function_">readFileSync</span>(<span class="hljs-title function_">getFile</span>(file), encoding);
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">emit</span> = (<span class="hljs-params">file, content</span>) =&gt; {
    <span class="hljs-title function_">mkdirSync</span>(path.<span class="hljs-title function_">dirname</span>(<span class="hljs-title function_">getFile</span>(file)), { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> });

    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">existsSync</span>(content)) {
      <span class="hljs-keyword">const</span> src = content;

      <span class="hljs-title function_">copyFileSync</span>(src, <span class="hljs-title function_">getFile</span>(file));

      <span class="hljs-keyword">return</span>;
    }
    
    <span class="hljs-title function_">writeFileSync</span>(<span class="hljs-title function_">getFile</span>(file), content);
  }

  <span class="hljs-title function_">clear</span>();

  <span class="hljs-keyword">return</span> {
    <span class="hljs-keyword">get</span> <span class="hljs-title function_">dir</span>() {
      <span class="hljs-keyword">return</span> dir;
    },
    getFile,
    clear,
    exists,
    read,
    emit
  };
}</code></pre>
    </div>
  </div>
</main>

    <div class="footer">
      <div class="center">
        &copy; 2018 <a href="https//benignware.com">Benignware</a>
      </div>
    </div>
  </body>
</html>